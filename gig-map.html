---
---

<div id='gig-map' class='gig-map'></div>

<script>
  map = L.map('gig-map').setView(
    [
      51.50979,
      -0.13204
    ],
    11
  );

  L.tileLayer('//stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png', {
    subdomains: 'abcd',
    minZoom: 1,
    maxZoom: 20,
  }).addTo(map)

  L.tileLayer('//stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}.png', {
    attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> | Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    subdomains: 'abcd',
    minZoom: 1,
    maxZoom: 20
  }).addTo(map)

  $.ajax({
    headers: {
      Accept: 'application/vnd.geo+json'
    },
    url: 'http://data.rawfunkmaharishi.uk/gigs',
    dataType: 'json'
  }).done(function(data) {
    L.geoJson(data, {
      onEachFeature: onEachFeature
    }).addTo(map)
  })

  function onEachFeature(feature, layer) {
    s = '<div class="gig-popup">'
    s += feature.properties.name
    s += '<hr />'

    $.each(feature.properties.gigs, function(index, gig) {
      s += '<a href="' + gig.url + '">'
      s += moment(gig.date).format('dd YYYY')
      s += '</a>'
      s += '<br />'
    })

    s += '</div>'

    layer.bindPopup(s)
  }
</script>
